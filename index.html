<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppsFlyer Attribution & SKAN Simulator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 30px; }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { font-size: 1em; opacity: 0.95; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-tab { background: white; border: none; padding: 12px 24px; border-radius: 10px 10px 0 0; cursor: pointer; font-size: 15px; font-weight: 600; color: #667eea; transition: all 0.3s ease; }
        .nav-tab:hover { background: #f0f0f0; }
        .nav-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .content-panel { background: white; border-radius: 0 10px 10px 10px; padding: 30px; min-height: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .setup-section, .media-section { background: #f9f9f9; border-radius: 12px; padding: 25px; margin-bottom: 25px; }
        h2 { color: #667eea; margin-bottom: 15px; font-size: 1.15em; }
        h3 { color: #667eea; margin-top: 20px; margin-bottom: 15px; }
        h4 { color: #667eea; margin-top: 15px; margin-bottom: 10px; }
        .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        .control-group label { font-weight: 600; color: #333; font-size: 0.95em; }
        .radio-group { display: flex; flex-direction: column; gap: 8px; border: 2px solid #d0d0d0; border-radius: 6px; padding: 8px; }
        .radio-item { display: flex; align-items: center; gap: 8px; padding: 6px; cursor: pointer; }
        .radio-item input { cursor: pointer; width: 16px; height: 16px; }
        .radio-item label { margin: 0; cursor: pointer; font-weight: 500; flex: 1; font-size: 0.9em; }
        .info-box { background: #e7f3ff; border-left: 4px solid #2196F3; padding: 12px; border-radius: 4px; margin-bottom: 15px; color: #0c5460; font-size: 0.85em; }
        .partner-list { display: flex; flex-direction: column; gap: 15px; margin-bottom: 15px; }
        .partner-card { border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; background: white; }
        .partner-row { display: grid; grid-template-columns: 1.2fr 0.8fr 0.8fr 0.8fr 0.8fr 70px; gap: 10px; align-items: flex-end; }
        .field-group { display: flex; flex-direction: column; gap: 4px; }
        .field-group label { font-weight: 600; color: #666; font-size: 0.8em; }
        select, input { padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 0.85em; width: 100%; }
        select:focus, input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1); }
        .remove-btn { padding: 8px 12px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.75em; width: 100%; }
        .remove-btn:hover { background: #ff5252; }
        .action-buttons { display: flex; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.95em; transition: all 0.2s ease; }
        .btn-primary { background: #667eea; color: white; flex: 1; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #f0f0f0; color: #333; flex: 1; }
        .btn-secondary:hover { background: #e0e0e0; }
        .btn-add { background: #28a745; color: white; width: 100%; margin-top: 10px; }
        .btn-add:hover { background: #20c997; }
        .window-visual { background: linear-gradient(135deg, #f0f7ff 0%, #e8f4f8 100%); border: 2px solid #667eea; border-radius: 12px; padding: 30px; margin: 20px 0; position: relative; overflow: hidden; }
        .bubble-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; border-radius: 10px; overflow: hidden; }
        .bubble { position: absolute; border-radius: 50%; opacity: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .bubble.size-sm { width: 8px; height: 8px; }
        .bubble.size-md { width: 12px; height: 12px; }
        .bubble.size-lg { width: 16px; height: 16px; }
        .bubble.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bubble.green { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .bubble.purple { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .bubble.pink { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .bubble.cyan { background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); }
        @keyframes float-up { 0% { transform: translateY(0) translateX(0) scale(1); opacity: 0; } 5% { opacity: 0.8; } 95% { opacity: 0.8; } 100% { transform: translateY(-350px) translateX(var(--tx, 0)) scale(0.3); opacity: 0; } }
        .timeline-bar { background: linear-gradient(90deg, #d4edda 0%, #fff 50%, #d1ecf1 100%); border-radius: 8px; height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; margin-bottom: 20px; border: 3px solid #667eea; position: relative; z-index: 2; }
        .event-flow { display: flex; align-items: center; gap: 12px; padding: 15px; background: white; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #667eea; animation: slideIn 0.6s ease-out; position: relative; z-index: 2; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        .event-icon { font-size: 2em; min-width: 50px; display: flex; align-items: center; justify-content: center; }
        .icon-click { animation: clickAnimation 1.5s infinite; }
        .icon-view { animation: viewAnimation 1.5s infinite; }
        @keyframes clickAnimation { 0%, 100% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.15) rotate(10deg); } }
        @keyframes viewAnimation { 0%, 100% { transform: scale(1) translateY(0); } 50% { transform: scale(1.15) translateY(-5px); } }
        .winner-box { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 3px solid #28a745; border-radius: 12px; padding: 30px; text-align: center; }
        .winner-box h3 { color: #155724; font-size: 1.2em; margin-bottom: 10px; }
        .winner-partner { color: #155724; font-size: 2em; font-weight: bold; margin: 15px 0; }
        .winner-details { color: #155724; font-size: 0.95em; line-height: 1.8; }
        .no-results { text-align: center; color: #999; padding: 60px 20px; }
        .info-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 10px; padding: 20px; margin-bottom: 20px; border-left: 4px solid #667eea; }
        .section-title { color: #667eea; font-size: 1.8em; margin-bottom: 20px; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .flow-diagram { background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .flow-step { background: white; border: 2px solid #667eea; border-radius: 10px; padding: 15px; margin: 10px 0; transition: all 0.3s ease; cursor: pointer; }
        .flow-step:hover { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: scale(1.02); }
        .flow-arrow { text-align: center; color: #667eea; font-size: 24px; margin: 10px 0; }
        .code-container { background: #1e1e1e; border-radius: 8px; margin: 20px 0; overflow: hidden; }
        .code-header { background: #2d2d2d; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; }
        .code-language { color: #4fc3f7; font-weight: 600; font-size: 14px; }
        .copy-btn { background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .code-content { padding: 20px; overflow-x: auto; font-family: 'Consolas', monospace; font-size: 12px; line-height: 1.6; color: #d4d4d4; white-space: pre; max-height: 400px; overflow-y: auto; }
        .schema-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .schema-card { background: white; border: 2px solid #667eea; border-radius: 10px; padding: 15px; text-align: center; transition: all 0.3s ease; cursor: pointer; }
        .schema-card:hover { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: translateY(-5px); }
        .bit-value { font-size: 20px; font-weight: bold; color: #667eea; margin-bottom: 10px; }
        .schema-card:hover .bit-value { color: white; }
        ul { margin-left: 20px; margin-top: 10px; line-height: 1.8; }
        ol { margin-left: 20px; margin-top: 10px; line-height: 1.8; }
        @media (max-width: 768px) { .partner-row { grid-template-columns: 1fr; } header h1 { font-size: 1.8em; } }
        .best-practice-section { background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-left: 5px solid #667eea; border-radius: 8px; padding: 25px; margin: 25px 0; }
        .best-practice-section h3 { color: #667eea; font-size: 1.1em; margin-bottom: 15px; }
        .best-practice-section ul { margin-left: 25px; }
        .best-practice-section li { margin-bottom: 12px; line-height: 1.8; color: #333; font-weight: 500; }
        .best-practice-highlight { background: #fff9e6; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #ffc107; }
        .best-practice-highlight strong { color: #f57f17; }
    </style>
</head>
<body>
    <div class="container">
        <header style="margin-bottom: 20px; padding: 0;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 12px; text-align: center; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; text-align: center;">
                    <h1 style="margin: 0; font-size: 2.2em; color: white;">AppsFlyer Attribution</h1>
                </div>
            </div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="attribution">üìä Attribution</button>
            <button class="nav-tab" data-tab="skan">üçé SKAN</button>
            <button class="nav-tab" data-tab="useful-links">üîó Useful Links</button>
            <button class="nav-tab" data-tab="deep-linking">üéØ Deep Linking</button>
            <button class="nav-tab" data-tab="best-practices">‚≠ê Best Practices</button>
        </div>

        <div class="content-panel">
            <!-- ATTRIBUTION TAB -->
            <div id="attribution" class="tab-content active">
                <div class="setup-section">
                    <h2><i class="fas fa-globe"></i> Step 1: Environment & Consent</h2>
                    <div class="control-grid">
                        <div class="control-group">
                            <label>Environment</label>
                            <div class="radio-group">
                                <div class="radio-item"><input type="radio" id="env-android" name="environment" value="android" checked onchange="updateAttributionType()"><label for="env-android">ü§ñ Android App</label></div>
                                <div class="radio-item"><input type="radio" id="env-ios" name="environment" value="ios" onchange="updateAttributionType()"><label for="env-ios">üçé iOS App</label></div>
                                <div class="radio-item"><input type="radio" id="env-mobile-safari" name="environment" value="mobile-safari" onchange="updateAttributionType()"><label for="env-mobile-safari">üåê Mobile Web - Safari</label></div>
                                <div class="radio-item"><input type="radio" id="env-mobile-chrome" name="environment" value="mobile-chrome" onchange="updateAttributionType()"><label for="env-mobile-chrome">üåê Mobile Web - Chrome</label></div>
                                <div class="radio-item"><input type="radio" id="env-mobile-firefox" name="environment" value="mobile-firefox" onchange="updateAttributionType()"><label for="env-mobile-firefox">üåê Mobile Web - Firefox</label></div>
                                <div class="radio-item"><input type="radio" id="env-desktop-mac" name="environment" value="desktop-mac" onchange="updateAttributionType()"><label for="env-desktop-mac">üíª Desktop - Mac</label></div>
                                <div class="radio-item"><input type="radio" id="env-desktop-windows" name="environment" value="desktop-windows" onchange="updateAttributionType()"><label for="env-desktop-windows">ü™ü Desktop - Windows</label></div>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Consent (ATT / User Tracking)</label>
                            <div class="radio-group">
                                <div class="radio-item"><input type="radio" id="consent-present" name="consent" value="present" checked onchange="updateAttributionType()"><label for="consent-present">‚úÖ Consent Granted</label></div>
                                <div class="radio-item"><input type="radio" id="consent-absent" name="consent" value="absent" onchange="updateAttributionType()"><label for="consent-absent">‚ùå Consent Denied</label></div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="attribution-type-display" style="margin-top: 20px; padding: 15px; background: #f0f7ff; border-radius: 8px; border-left: 4px solid #2196F3;">
                        <strong style="color: #0c5460;">üìä Attribution Type:</strong>
                        <div id="attr-type-value" style="font-size: 1.1em; color: #0c5460; margin-top: 8px; font-weight: 600;">Deterministic Click-Through (GAID)</div>
                        <div id="attr-accuracy" style="font-size: 0.9em; color: #0c5460; margin-top: 5px;">Accuracy: 99%+ | Device-level matching</div>
                        <div id="attr-signals" style="font-size: 0.85em; color: #0c5460; margin-top: 8px; display: none;"></div>
                    </div>
                </div>

                <div class="media-section">
                    <h2><i class="fas fa-bullseye"></i> Step 2: Add Media Partners (10 Available)</h2>
                    <div class="info-box"><i class="fas fa-info-circle"></i> Select partner, type, date/time, and lookback window.</div>
                    <div class="partner-list" id="partners-container"></div>
                    <button class="btn btn-add" id="add-partner-btn"><i class="fas fa-plus"></i> Add Media Partner</button>
                </div>

                <div class="media-section">
                    <h2><i class="fas fa-download"></i> Step 3: Installation Event</h2>
                    <div class="control-grid" style="margin-bottom: 20px;">
                        <div class="control-group"><label>Install Date</label><input type="date" id="install-date"></div>
                        <div class="control-group"><label>Install Time</label><input type="time" id="install-time"></div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="calculate-btn"><i class="fas fa-calculator"></i> Calculate</button>
                        <button class="btn btn-secondary" id="reset-btn"><i class="fas fa-redo"></i> Reset</button>
                    </div>
                </div>

                <div id="animation-container" style="display: none;">
                    <div class="window-visual">
                        <div class="bubble-container" id="bubble-container"></div>
                        <div style="text-align: center; color: #667eea; font-weight: 600; margin-bottom: 20px; position: relative; z-index: 1;">‚ú® Attribution Window ‚ú®</div>
                        <div class="timeline-bar">
                            <div style="color: #667eea; font-weight: 600;">30 DAYS</div>
                            <div style="background: #28a745; color: white; padding: 8px 12px; border-radius: 6px; text-align: center;"><div>üì± INSTALL</div><div style="font-size: 0.85em;" id="install-time-display"></div></div>
                            <div style="color: #667eea; font-weight: 600;">NOW</div>
                        </div>
                        <div id="events-flow"></div>
                    </div>
                </div>

                <!-- SKAN 4.0 Flow Explanation -->
                <div class="info-card" style="margin-top: 30px; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%); color: white;">
                    <h3>üì± SKAN 4.0 Attribution (iOS Consent Denied)</h3>
                    <p style="font-size: 13px; line-height: 1.6;"><strong>Critical:</strong> When iOS user denies consent, AppsFlyer uses SKAN 4.0 which operates on <strong>CLICKS ONLY</strong> (0-35 days). Impressions are completely ignored.</p>
                    
                    <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong style="color: #FFD700;">‚ö° SKAN 4.0 Click Flow:</strong>
                        <div style="font-size: 12px; margin-top: 8px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 3px;">üë§ Click</span>
                            <span>‚Üí</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 3px;">üì≤ App Install</span>
                            <span>‚Üí</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 3px;">‚úÖ Conversion</span>
                            <span>‚Üí</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 3px;">üì§ Postback</span>
                        </div>
                    </div>
                </div>

                <!-- Attribution Waterfall Priority -->
                <div class="info-card" style="margin-top: 30px; background: #f8f9fa; border: 2px solid #667eea;">
                    <h3 style="color: #667eea;">üìä AppsFlyer Attribution Waterfall Priority</h3>
                    <p style="font-size: 12px; color: #555; line-height: 1.5;">AppsFlyer prioritizes attribution methods in this order:</p>
                    
                    <div style="margin-top: 15px; space: 0;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-start;">
                            <div style="background: #0066FF; color: white; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 11px; min-width: 35px;">1st</div>
                            <div style="flex: 1;">
                                <strong style="color: #0066FF;">Deterministic Click</strong>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">Device ID matching (IDFA/GAID) - Highest accuracy 99%+</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-start;">
                            <div style="background: #7B5BA3; color: white; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 11px; min-width: 35px;">2nd</div>
                            <div style="flex: 1;">
                                <strong style="color: #7B5BA3;">Probabilistic Click</strong>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">Browser fingerprint + IP matching - 65-80% accuracy</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-start;">
                            <div style="background: #10B981; color: white; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 11px; min-width: 35px;">3rd</div>
                            <div style="flex: 1;">
                                <strong style="color: #10B981;">Deterministic View</strong>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">View-through engagement based on identifiers</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-start;">
                            <div style="background: #F59E0B; color: white; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 11px; min-width: 35px;">4th</div>
                            <div style="flex: 1;">
                                <strong style="color: #F59E0B;">Probabilistic View</strong>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">View impressions with fingerprinting - Lowest confidence</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: flex-start; background: #FFE5E5; padding: 8px; border-radius: 4px;">
                            <div style="background: #EF4444; color: white; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 11px; min-width: 35px;">iOS</div>
                            <div style="flex: 1;">
                                <strong style="color: #EF4444;">SKAN 4.0 (No Consent) - Click Attribution ONLY</strong>
                                <div style="font-size: 11px; color: #EF4444; margin-top: 2px; font-weight: bold;">‚ö†Ô∏è ONLY Recent clicks within 0-35 days receive credit</div>
                                <div style="font-size: 10px; color: #666; margin-top: 4px;">‚ùå View-through impressions COMPLETELY IGNORED ‚Ä¢ Postback: 0-2, 3-7, 8-35 days ‚Ä¢ ~60% accuracy</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="media-section" style="margin-top: 25px;">
                    <h2><i class="fas fa-chart-line"></i> Results</h2>
                    <div id="results-container"><div class="no-results"><i class="fas fa-arrow-down" style="font-size: 2em;"></i><p>Add partners and calculate</p></div></div>
                </div>
            </div>

            <!-- SKAN TAB - COMPLETE -->
            <div id="skan" class="tab-content">
                <h2 class="section-title">üçé SKAdNetwork (SKAN) Complete Technical Guide</h2>

                <div class="info-card">
                    <h3>üì± What is SKAdNetwork?</h3>
                    <p>SKAdNetwork is Apple's privacy-preserving attribution framework introduced to maintain user privacy while enabling app install attribution and campaign measurement.</p>
                </div>

                <div class="info-card">
                    <h3>üîí Why Was SKAN Introduced?</h3>
                    <ul>
                        <li>iOS 14.5+ App Tracking Transparency (ATT) framework</li>
                        <li>User privacy protection - no device-level data sharing</li>
                        <li>Aggregate campaign performance measurement</li>
                        <li>Elimination of IDFA dependency</li>
                    </ul>
                </div>

                <div class="flow-diagram">
                    <h3>üìà SKAN Data Flow</h3>
                    <div class="flow-step"><strong>1. Ad Display</strong><p>User sees ad in source app</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>2. App Install</strong><p>User installs advertised app from App Store</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>3. Conversion Value Update</strong><p>App updates conversion value (0-63) based on user actions</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>4. Timer Window</strong><p>24-48 hour timer + random delay</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>5. Postback to Ad Network</strong><p>Apple sends attribution data to ad network</p></div>
                </div>

                <h2 class="section-title" style="margin-top: 40px;">Digital App Signals in SKAN</h2>

                <div class="info-card">
                    <h3>1Ô∏è‚É£ Primary SKAN Signals</h3>
                    
                    <h4>üì± Conversion Value (CV)</h4>
                    <ul>
                        <li><strong>Range:</strong> 0-63 (6-bit value)</li>
                        <li><strong>Purpose:</strong> Encodes post-install user behavior</li>
                        <li><strong>Update Window:</strong> 0-72 hours post-install</li>
                        <li><strong>Key Rule:</strong> Can only increase, never decrease</li>
                    </ul>
                    
                    <div class="code-container" style="margin-top: 15px;">
                        <div class="code-header">
                            <span class="code-language">Swift - iOS Implementation</span>
                        </div>
                        <div class="code-content">// Update conversion value in iOS
SKAdNetwork.updateConversionValue(42) // Updates to value 42</div>
                    </div>

                    <h4>üéØ Source App ID</h4>
                    <ul>
                        <li><strong>What it is:</strong> Bundle ID of app where ad was displayed</li>
                        <li><strong>Privacy Threshold:</strong> Only shared if enough installs occur</li>
                        <li><strong>Purpose:</strong> Helps identify which publisher app drove the install</li>
                    </ul>

                    <h4>üè∑Ô∏è Campaign ID</h4>
                    <ul>
                        <li><strong>Range:</strong> 1-100</li>
                        <li><strong>Purpose:</strong> Identifies which ad campaign drove the install</li>
                        <li><strong>Configuration:</strong> Set by advertiser in ad network</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>2Ô∏è‚É£ SKAN 4.0+ Additional Signals</h3>
                    
                    <h4>üìà Coarse Conversion Value</h4>
                    <ul>
                        <li><strong>Low:</strong> Basic user engagement</li>
                        <li><strong>Medium:</strong> Moderate user value</li>
                        <li><strong>High:</strong> High-value user actions</li>
                        <li><strong>Null:</strong> If insufficient data for privacy</li>
                    </ul>

                    <h4>üîó Source Domain</h4>
                    <ul>
                        <li>Web-to-app attribution support</li>
                        <li>Shows domain where ad was displayed (Safari/web)</li>
                        <li>Enables mobile web campaign tracking</li>
                    </ul>

                    <h4>‚è∞ Multiple Conversion Windows</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <strong>Window 1:</strong> 0-2 days (fine-grained CV)<br>
                        <strong>Window 2:</strong> 3-7 days (coarse CV)<br>
                        <strong>Window 3:</strong> 8-35 days (coarse CV only)
                    </div>
                </div>

                <div class="info-card">
                    <h3>3Ô∏è‚É£ Conversion Value Mapping Examples</h3>
                    
                    <h4>üí∞ Revenue-Focused Schema</h4>
                    <div class="code-container" style="margin-top: 10px;">
                        <div class="code-header">
                            <span class="code-language">6-Bit Mapping</span>
                        </div>
                        <div class="code-content">Bits 0-1: Revenue Bands
  00 = $0
  01 = $1-50
  10 = $51-100
  11 = $100+

Bit 2: Subscription Started (1/0)
Bit 3: Premium Feature Used (1/0)
Bit 4: Tutorial Completed (1/0)
Bit 5: Social Share (1/0)</div>
                    </div>

                    <h4>üìä Engagement-Focused Schema</h4>
                    <div class="code-container" style="margin-top: 10px;">
                        <div class="code-header">
                            <span class="code-language">6-Bit Mapping</span>
                        </div>
                        <div class="code-content">Bits 0-2: Session Count
  000 = 0 sessions
  001 = 1 session
  010 = 2-3 sessions
  011 = 4-5 sessions
  100 = 6-10 sessions
  101 = 11+ sessions

Bit 3: Push Notification Enabled
Bit 4: Account Created
Bit 5: Content Viewed</div>
                    </div>

                    <h4>üîÑ Signal Flow in Practice</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <strong>User Action ‚Üí App Event ‚Üí Conversion Value Update ‚Üí SKAN Postback</strong><br><br>
                        <strong>Example Flow:</strong><br>
                        1. <strong>Install:</strong> CV = 0<br>
                        2. <strong>Tutorial Complete:</strong> CV = 16 (bit 4 set)<br>
                        3. <strong>First Purchase $25:</strong> CV = 17 (bits 0 and 4 set)<br>
                        4. <strong>Second Purchase $75:</strong> CV = 19 (bits 0-1 and 4 set)<br>
                        5. <strong>Subscribe:</strong> CV = 23 (bits 0-2 and 4 set)
                    </div>
                </div>

                <h2 class="section-title">AppsFlyer SKAN Solution</h2>

                <div class="info-card">
                    <h3>üéØ What is AppsFlyer SKAN?</h3>
                    <p>AppsFlyer's advanced solution that maximizes the value of SKAdNetwork data through intelligent conversion value mapping, predictive analytics, and comprehensive reporting.</p>
                </div>

                <div class="flow-diagram">
                    <h3>üîÑ AppsFlyer SKAN Data Flow</h3>
                    <div class="flow-step"><strong>1. SDK Integration</strong><p>AppsFlyer SDK tracks events and manages CV updates</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>2. Event Mapping</strong><p>Events mapped to 6-bit conversion value schema</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>3. Smart CV Management</strong><p>Optimized CV updates within Apple's constraints</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>4. Data Collection</strong><p>SKAN postbacks received and processed</p></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step"><strong>5. Analytics & Reporting</strong><p>Enriched data with predictive analytics in dashboard</p></div>
                </div>

                <div class="info-card">
                    <h3>4Ô∏è‚É£ AppsFlyer Enhanced Signals</h3>
                    <p>Beyond standard SKAN signals, AppsFlyer adds advanced analytics and predictions:</p>
                    
                    <h4>ü§ñ Predictive Analytics</h4>
                    <ul>
                        <li><strong>Predicted LTV:</strong> Machine learning models estimate lifetime value based on early user behavior</li>
                        <li><strong>Churn Probability:</strong> Likelihood of user retention calculated from engagement patterns</li>
                        <li><strong>Conversion Probability:</strong> Chance of making purchase based on similar user cohorts</li>
                        <li><strong>Revenue Predictions:</strong> Expected revenue in next 7, 14, 30 days</li>
                    </ul>

                    <h4>üìä Aggregated Metrics</h4>
                    <ul>
                        <li><strong>ARPU (Average Revenue Per User):</strong> Revenue metrics across campaigns</li>
                        <li><strong>Retention Rates:</strong> Day 1, 3, 7, 14, 30 retention cohorts</li>
                        <li><strong>Cohort Performance:</strong> Comparative analysis across user segments</li>
                        <li><strong>ROI Calculations:</strong> Campaign profitability analysis</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>5Ô∏è‚É£ Signal Flow in AppsFlyer</h3>
                    <div class="code-container">
                        <div class="code-header">
                            <span class="code-language">Flutter/Dart Implementation</span>
                            <button class="copy-btn" onclick="copyCode('signal-flow-code')">üìã Copy Code</button>
                        </div>
                        <div class="code-content" id="signal-flow-code">class SKANSignalManager {
  int _conversionValue = 0;
  
  // Update conversion value based on user actions
  void updateSignals({
    double? revenue,
    bool? signedUp,
    bool? madePayment,
    bool? subscribedPremium,
    int? sessionCount,
  }) {
    int newCV = _conversionValue;
    
    // Revenue bands (bits 0-1)
    if (revenue != null) {
      if (revenue > 100) {
        newCV |= 0x03; // Set bits 0-1 to 11
      } else if (revenue > 50) {
        newCV |= 0x02; // Set bits 0-1 to 10
      } else if (revenue > 0) {
        newCV |= 0x01; // Set bits 0-1 to 01
      }
    }
    
    // User actions (bits 2-5)
    if (signedUp == true) newCV |= 0x04;      // Bit 2
    if (madePayment == true) newCV |= 0x08;    // Bit 3
    if (subscribedPremium == true) newCV |= 0x10; // Bit 4
    
    // Session engagement (bit 5)
    if (sessionCount != null && sessionCount > 3) {
      newCV |= 0x20; // Bit 5
    }
    
    // Only update if value increases
    if (newCV > _conversionValue) {
      _conversionValue = newCV;
      _sendToAppsFlyer(newCV);
    }
  }
  
  void _sendToAppsFlyer(int cv) {
    // AppsFlyer handles the actual SKAN update
    print('Updating SKAN CV to: $cv');
  }
}</div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>6Ô∏è‚É£ Privacy-Preserving Signals</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h4 style="color: #ff6b6b;">‚ùå What SKAN Does NOT Send:</h4>
                            <ul>
                                <li>User ID or Device ID (IDFA)</li>
                                <li>Exact timestamp of install</li>
                                <li>Exact timestamp of conversion</li>
                                <li>IP address</li>
                                <li>Detailed user demographics</li>
                                <li>Exact revenue amounts</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #51cf66;">‚úÖ What SKAN DOES Send:</h4>
                            <ul>
                                <li>Aggregated conversion value</li>
                                <li>Campaign ID</li>
                                <li>Source app (with threshold)</li>
                                <li>Coarse timing (window-based)</li>
                                <li>Install validation</li>
                                <li>Coarse conversion value (SKAN 4.0)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>7Ô∏è‚É£ Signal Optimization Strategies</h3>
                    
                    <h4>üõçÔ∏è For E-commerce Apps:</h4>
                    <ul>
                        <li>Focus bits on revenue ranges and purchase frequency</li>
                        <li>Track cart value tiers and checkout completion</li>
                        <li>Monitor product category performance</li>
                        <li>Use AppsFlyer's revenue prediction models</li>
                    </ul>

                    <h4>üéÆ For Gaming Apps:</h4>
                    <ul>
                        <li>Track level progression milestones</li>
                        <li>Monitor in-app purchase tiers</li>
                        <li>Measure retention checkpoints</li>
                        <li>Leverage AppsFlyer's player LTV predictions</li>
                    </ul>

                    <h4>üì± For Subscription Apps:</h4>
                    <ul>
                        <li>Track trial starts and conversions</li>
                        <li>Monitor subscription tier upgrades</li>
                        <li>Measure feature adoption rates</li>
                        <li>Use AppsFlyer's churn prediction models</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>8Ô∏è‚É£ Testing Digital Signals in AppsFlyer</h3>
                    
                    <div class="code-container">
                        <div class="code-header">
                            <span class="code-language">iOS Test Configuration</span>
                        </div>
                        <div class="code-content">// SKAdNetwork Test Profile
{
  "SKAdNetworkTestMode": true,
  "TestConversionValues": [0, 15, 31, 63],
  "TestPostbackDelay": 5, // seconds instead of 24-48 hours
  "AppsFlyerTestMode": true,
  "DebugVerbosity": "high"
}</div>
                    </div>

                    <h4>Testing Steps:</h4>
                    <ol>
                        <li>Register test device in AppsFlyer dashboard</li>
                        <li>Enable SKAN debug mode in SDK</li>
                        <li>Use Apple's SKAdNetwork test profile</li>
                        <li>Monitor real-time CV updates in debug console</li>
                        <li>Validate postbacks in AppsFlyer test dashboard</li>
                    </ol>
                </div>

                <div class="info-card">
                    <h3>9Ô∏è‚É£ Signal Limitations & AppsFlyer Workarounds</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h4 style="color: #ff6b6b;">‚ö†Ô∏è SKAN Limitations:</h4>
                            <ul>
                                <li>Only 64 possible values (6 bits)</li>
                                <li>Can't decrease once set</li>
                                <li>24-48 hour delay in reporting</li>
                                <li>No user-level data</li>
                                <li>Limited attribution windows</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #51cf66;">üí° AppsFlyer Solutions:</h4>
                            <ul>
                                <li>Predictive modeling for full LTV</li>
                                <li>Statistical models to fill gaps</li>
                                <li>Aggregated cross-campaign reporting</li>
                                <li>Machine learning pattern recognition</li>
                                <li>Single Source of Truth dashboard</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üîü AppsFlyer Conversion Studio</h3>
                    <p>Visual tool for optimizing your conversion value schema:</p>
                    
                    <h4>Key Features:</h4>
                    <ul>
                        <li><strong>Visual Schema Builder:</strong> Drag-and-drop interface for CV configuration</li>
                        <li><strong>Revenue Optimizer:</strong> Automatically suggests optimal revenue bands</li>
                        <li><strong>A/B Testing:</strong> Test different schemas across user segments</li>
                        <li><strong>Performance Simulator:</strong> Preview expected results before deployment</li>
                        <li><strong>Smart Recommendations:</strong> AI-powered suggestions based on your app type</li>
                    </ul>

                    <h4>Schema Templates:</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <strong>‚Ä¢ E-commerce Template:</strong> Revenue + Cart + Checkout signals<br>
                        <strong>‚Ä¢ Gaming Template:</strong> Level + IAP + Retention signals<br>
                        <strong>‚Ä¢ Subscription Template:</strong> Trial + Tier + Engagement signals<br>
                        <strong>‚Ä¢ Custom Template:</strong> Build your own from scratch
                    </div>
                </div>


                <h2 class="section-title" style="margin-top: 40px;">Technical Requirements & Resources</h2>

                <div class="info-card">
                    <h3>üìã TR1: AppsFlyer Flutter SDK Integration</h3>
                    <p><strong>GitHub:</strong> <a href="https://github.com/AppsFlyerSDK/appsflyer-flutter-plugin" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">AppsFlyerSDK/appsflyer-flutter-plugin</a></p>
                    <p style="margin-top: 10px;">Complete Flutter plugin for SKAN integration, event tracking, and deep linking.</p>
                </div>

                <div class="info-card">
                    <h3>üçé TR2: SKAN Network IDs</h3>
                    <p><strong>GitHub:</strong> <a href="https://github.com/skadnetwork/ad-network-ids" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">skadnetwork/ad-network-ids</a></p>
                    <p style="margin-top: 10px;">Official SKAdNetwork ID registry - required for all supported ad networks.</p>
                </div>

                <div class="info-card">
                    <h3>üîó AppsFlyer SDKs - All Platforms</h3>
                    <p><strong>Main Repository:</strong> <a href="https://github.com/AppsFlyerSDK" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">github.com/AppsFlyerSDK</a></p>
                    <p style="margin-top: 10px;"><strong>Available SDKs:</strong></p>
                    <ul>
                        <li><a href="https://github.com/AppsFlyerSDK/appsflyer-ios-sdk" target="_blank" style="color: #667eea;">iOS SDK</a></li>
                        <li><a href="https://github.com/AppsFlyerSDK/AppsFlyerSDK-Android" target="_blank" style="color: #667eea;">Android SDK</a></li>
                        <li><a href="https://github.com/AppsFlyerSDK/appsflyer-react-native-plugin" target="_blank" style="color: #667eea;">React Native</a></li>
                        <li><a href="https://github.com/AppsFlyerSDK/appsflyer-flutter-plugin" target="_blank" style="color: #667eea;">Flutter</a></li>
                        <li><a href="https://github.com/AppsFlyerSDK/appsflyer-web-sdk" target="_blank" style="color: #667eea;">Web SDK</a></li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üß™ TR3 & TR4: Testing & Validation</h3>
                    <p><strong>Documentation:</strong> <a href="https://support.appsflyer.com/hc/en-us/articles/207032066" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">SKAdTest Postback Testing</a></p>
                    <p style="margin-top: 10px;">Complete testing guide for SKAN postback validation, CV testing, and postback verification.</p>
                </div>

                <div class="info-card">
                    <h3>üìö TR5: Developer Documentation</h3>
                    <p style="margin-top: 10px;"><strong>Complete package includes:</strong></p>
                    <ul>
                        <li>Setup guide and initialization</li>
                        <li>API reference documentation</li>
                        <li>Code examples and patterns</li>
                        <li>QA scenarios and checklists</li>
                        <li>Best practices and optimization</li>
                        <li>Troubleshooting guide</li>
                    </ul>
                </div>

                <div class="info-card" style="background: #e8f4f8; border-left: 4px solid #2196F3;">
                    <h3 style="color: #0c5460;">‚úÖ Implementation Checklist</h3>
                    <ul style="margin-top: 15px; color: #0c5460;">
                        <li>‚òê Integrate AppsFlyer Flutter Plugin</li>
                        <li>‚òê Add SKAN Network IDs to Info.plist</li>
                        <li>‚òê Initialize AppsFlyer SDK</li>
                        <li>‚òê Configure CV mapping schema</li>
                        <li>‚òê Implement event tracking</li>
                        <li>‚òê Test with SKAdTest tool</li>
                        <li>‚òê Validate in AppsFlyer dashboard</li>
                        <li>‚òê Deploy to production</li>
                        <li>‚òê Monitor SKAN postbacks</li>
                    </ul>
                </div>

                <div class="info-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>üöÄ AppsFlyer SKAN Advantages</h3>
                    <div style="color: white; font-size: 1.05em;">
                        <div style="margin-bottom: 12px;">‚Ä¢ üìä <strong>Enhanced Analytics:</strong> Go beyond basic SKAN with predictive models</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ üìà <strong>Unified Dashboard:</strong> Single view for all attribution data</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ üîÆ <strong>Predictive Insights:</strong> LTV and churn predictions from limited data</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ üéØ <strong>Smart Optimization:</strong> AI-powered CV schema recommendations</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ üõ°Ô∏è <strong>Privacy Compliant:</strong> Full adherence to Apple's guidelines</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ ‚ö° <strong>Real-time Processing:</strong> Immediate CV updates and monitoring</div>
                        <div style="margin-bottom: 12px;">‚Ä¢ üîß <strong>Easy Integration:</strong> Simple SDK with Flutter support</div>
                    </div>
                </div>
            </div>

            <!-- Useful Links Tab -->
            <div id="useful-links" class="tab-content">
                <h2 class="section-title">üîó Useful Links & Resources</h2>

                <div class="info-card">
                    <h3>üì± OneLink Setup & Structure</h3>
                    <p>Complete setup documentation for creating flexible mobile measurement links</p>
                    
                    <h4>Resources:</h4>
                    <ul>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/115005248543-OneLink-guide" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">OneLink Guide</a> - Complete OneLink overview</li>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/207032246-Create-a-OneLink-template" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Create OneLink Templates</a> - Flexible link templates</li>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/360002329137-Brand-OneLink-with-your-domain" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Brand Your OneLink</a> - Use your own domain</li>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/207447163-About-link-structure-and-parameters" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Link Parameters</a> - Attribution parameters guide</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üîÄ Deep Linking Methods</h3>
                    <p>Best practices using Universal Links and App Links for seamless routing across devices</p>
                    
                    <ul>
                        <li><a href="https://dev.appsflyer.com/hc/docs/dl_work_flow" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Deep Linking Workflow</a> - Complete implementation guide</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üîó Link Creation Options</h3>
                    <p>Multiple methods to create OneLink links for your campaigns</p>
                    
                    <h4>Creation Methods:</h4>
                    <ul>
                        <li><strong>OneLink API:</strong> <a href="https://support.appsflyer.com/hc/en-us/articles/360001250345-Use-OneLink-API-to-create-links-in-large-scale-campaigns" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">API Documentation</a> - Programmatic link generation</li>
                        <li><strong>Bulk CSV:</strong> <a href="https://support.appsflyer.com/hc/en-us/articles/14511403892369-Perform-OneLink-bulk-actions-via-CSV" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Bulk CSV Upload</a> - Create 100+ links at once</li>
                        <li><strong>Manual UI:</strong> Dashboard link builder for quick testing and single campaign creation</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üéØ Deep Linking with SRNs</h3>
                    <p>Source-Related Networks (SRNs) for tracking which specific network/partner drove the install</p>
                    
                    <ul>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/360001546905-Self-reporting-networks-SRNs" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">SRN Deep Linking Guide</a> - Complete SRN implementation</li>
                    </ul>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong>Implementation Parameter:</strong><br>
                        <code style="color: #667eea; font-weight: 600;">af_srn=network_name</code><br><br>
                        <strong>Use Cases:</strong>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Multi-partner tracking</li>
                            <li>Revenue attribution by network</li>
                            <li>Cohort analysis across SRNs</li>
                            <li>Partner commission calculations</li>
                        </ul>
                    </div>
                </div>

                <div class="info-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>üìö Quick Links Summary</h3>
                    <ul style="color: white;">
                        <li>‚úÖ OneLink Guide - Full platform overview</li>
                        <li>‚úÖ Template & Branding - Customize your links</li>
                        <li>‚úÖ Link Parameters - Attribution tracking</li>
                        <li>‚úÖ Deep Linking Workflow - Implementation guide</li>
                        <li>‚úÖ OneLink API - Programmatic creation</li>
                        <li>‚úÖ Bulk CSV - Scale link creation</li>
                        <li>‚úÖ SRN Deep Linking - Network attribution</li>
                    </ul>
                </div>
            </div>

            <!-- DEEP LINKING BEST PRACTICES TAB -->
            <div id="deep-linking" class="tab-content">
                <h2 class="section-title">üéØ Deep Linking Best Practices & Consent Guide</h2>

                <div class="best-practice-section">
                    <h3>üìå Understanding Deep Linking with AppsFlyer & Consent</h3>
                    <p style="margin-bottom: 15px; line-height: 1.8; color: #333;">
                        Deep linking in AppsFlyer relies on accurate attribution data capture through the SDK. When users grant consent, the system can fully leverage device identifiers and attribution matching. However, when consent is denied, you need alternative routing strategies to maintain functionality while respecting user privacy.
                    </p>
                </div>

                <div class="best-practice-highlight">
                    <strong>üîë Key Concept:</strong> Deferred deep linking (routing users to specific in-app content after install) depends on successful attribution data capture and matching via the SDK. The SDK must receive attribution data to execute dynamic routing based on campaign parameters.
                </div>

                <div class="best-practice-section">
                    <h3>‚úÖ When Consent is Granted</h3>
                    <ul>
                        <li><strong>Full Attribution Capture:</strong> The SDK receives and matches device identifiers (IDFA on iOS, GAID on Android) with campaign parameters</li>
                        <li><strong>Dynamic Deep Linking:</strong> Users are routed to specific in-app content based on the campaign that drove the install</li>
                        <li><strong>Callbacks Available:</strong> AppsFlyer SDK exposes callbacks like <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">onConversionDataReceived</code> and <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">onAppOpenAttribution</code> which provide deep linking info only when attribution is successful and permitted</li>
                        <li><strong>Enhanced Analytics:</strong> Campaign-based routing enables precise cohort analysis and conversion tracking</li>
                    </ul>
                </div>

                <div class="best-practice-highlight" style="background: #ffebee; border-left-color: #f44336;">
                    <strong>‚ö†Ô∏è When Consent is Denied:</strong> The SDK may not receive or return attribution data and deep link parameters since device identifiers and related tracking may be unavailable. Attribution-based deep linking won't function, but basic deep linking via universal/app links (without attribution) still works.
                </div>

                <div class="best-practice-section">
                    <h3>‚ùå Limitations Without Consent</h3>
                    <ul>
                        <li><strong>No Attribution Data:</strong> The SDK cannot access device identifiers needed for matching users to campaigns</li>
                        <li><strong>No Dynamic Routing:</strong> Without attribution, you cannot route users based on which campaign drove the install</li>
                        <li><strong>Callback Restrictions:</strong> Callbacks won't return deep linking parameters tied to AppsFlyer attribution</li>
                        <li><strong>Limited Analytics:</strong> Cannot accurately measure campaign effectiveness or user journey from ad to specific in-app content</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üîó Fallback Solutions Without Attribution</h3>
                    <p style="margin-bottom: 15px; line-height: 1.8; color: #333;">
                        The app can still handle universal links or custom URI schemes that open the app directly (non-attribution based deep linking), but these links won't carry AppsFlyer's attribution data for dynamic routing or enhanced analytics.
                    </p>
                    <ul>
                        <li><strong>Universal Links (iOS) / App Links (Android):</strong> Standard deep links that open specific app screens without requiring AppsFlyer attribution</li>
                        <li><strong>Custom URL Schemes:</strong> Your app can define custom schemes (e.g., <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">myapp://content/page</code>) to route users, but without campaign context</li>
                        <li><strong>Default Routing:</strong> Route consent-denied users to the app home screen or a generic onboarding experience</li>
                        <li><strong>No Campaign Context:</strong> These fallback links won't carry AppsFlyer's attribution data for dynamic routing or enhanced analytics</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üõ†Ô∏è Implementation Best Practices</h3>
                    <ul>
                        <li><strong>Implement Consent Checks:</strong> Always check user consent status before attempting to access AppsFlyer attribution data</li>
                        <li><strong>SDK Callback Handling:</strong> Use <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">onConversionDataReceived</code> and <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">onAppOpenAttribution</code> callbacks, but handle null/empty responses when consent is denied</li>
                        <li><strong>Fallback Logic:</strong> Design your app to gracefully handle both attribution-based and non-attribution-based deep linking scenarios</li>
                        <li><strong>User Experience:</strong> Ensure users without consent still get a seamless experience, even if they can't access campaign-specific content</li>
                        <li><strong>Privacy Compliance:</strong> Respect user choices and never attempt to track without proper consent, as this violates privacy regulations (GDPR, CCPA, etc.)</li>
                        <li><strong>Testing:</strong> Test both consent granted and denied scenarios to ensure your app handles both paths correctly</li>
                    </ul>
                </div>

                <div class="best-practice-highlight" style="background: #e8f5e9; border-left-color: #4caf50;">
                    <strong>‚úÖ Summary:</strong> AppsFlyer deep linking features function fully when consent is granted. When consent is denied, implement fallback universal/app links or custom schemes that don't rely on AppsFlyer attribution data. Always respect user privacy choices while maintaining a great user experience.
                </div>

                <div class="info-card" style="margin-top: 30px;">
                    <h3>üìö Additional Resources</h3>
                    <ul>
                        <li><a href="https://dev.appsflyer.com/hc/docs/dl_work_flow" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Deep Linking Workflow Documentation</a> - Complete implementation guide</li>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/207032246-Create-a-OneLink-template" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">OneLink Templates</a> - Create flexible deep linking URLs</li>
                        <li><a href="https://dev.appsflyer.com/hc/docs/ios_sdk_reference_appsflyerlib#onappOpenattribution" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">iOS SDK Reference - onAppOpenAttribution</a> - Callback documentation</li>
                        <li><a href="https://dev.appsflyer.com/hc/docs/android_sdk_reference#onconversion-data-received" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">Android SDK Reference - onConversionDataReceived</a> - Callback documentation</li>
                    </ul>
                </div>
            </div>

            <!-- BEST PRACTICES TAB -->
            <div id="best-practices" class="tab-content">
                <h2 class="section-title">‚≠ê AppsFlyer Best Practices</h2>

                <div class="best-practice-section">
                    <h3>üìã SDK Implementation & Initialization</h3>
                    <ul>
                        <li><strong>Initialize Early:</strong> Call AppsFlyer SDK initialization in your app delegate or application class before any other tracking code</li>
                        <li><strong>Set Dev Key:</strong> Configure your unique dev key from AppsFlyer dashboard during initialization</li>
                        <li><strong>Enable Debug Mode (Development Only):</strong> Use debug logging during development to verify events are being tracked, but disable in production</li>
                        <li><strong>Handle Callbacks:</strong> Implement all available callbacks (onConversionDataReceived, onAppOpenAttribution, etc.) to capture attribution data</li>
                        <li><strong>Test Before Release:</strong> Thoroughly test all tracking scenarios before deploying to production</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üîê Privacy & Consent Management</h3>
                    <ul>
                        <li><strong>Request Consent First:</strong> Always request user consent before tracking, following GDPR, CCPA, and local privacy regulations</li>
                        <li><strong>Respect User Choice:</strong> Honor both consent granted and denied states consistently</li>
                        <li><strong>Privacy Policy:</strong> Clearly disclose in your privacy policy what data AppsFlyer collects and how it's used</li>
                        <li><strong>Implement Opt-Out:</strong> Provide users with easy access to opt-out from tracking via app settings</li>
                        <li><strong>Data Retention:</strong> Understand AppsFlyer's data retention policies and configure appropriately for your region</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üìä Event Tracking & Attribution</h3>
                    <ul>
                        <li><strong>Track Key Events:</strong> Log critical in-app events (registration, purchase, subscription) for accurate ROI measurement</li>
                        <li><strong>Use Standardized Event Names:</strong> Follow AppsFlyer's recommended event names (af_purchase, af_add_to_cart, etc.) for better data accuracy</li>
                        <li><strong>Include Event Values:</strong> Always pass revenue, currency, and other relevant parameters with purchase events</li>
                        <li><strong>Consistent Parameters:</strong> Use standardized parameter names across all events for better analytics</li>
                        <li><strong>Real-Time Logging:</strong> Log events immediately when they occur, don't batch them for later</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üéØ Deep Linking Best Practices</h3>
                    <ul>
                        <li><strong>Implement Fallback Logic:</strong> Handle both attribution-based and non-attribution based deep linking scenarios</li>
                        <li><strong>Test All Paths:</strong> Test deep links with both consent granted and denied to ensure proper routing</li>
                        <li><strong>Use OneLink:</strong> Leverage AppsFlyer's OneLink for unified URL shortening and attribution</li>
                        <li><strong>Verify Deep Links:</strong> Test deep links on both iOS (Universal Links) and Android (App Links) before campaigns go live</li>
                        <li><strong>Handle Edge Cases:</strong> Plan for users who may have app already installed or direct app opens</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>üçé iOS-Specific Best Practices</h3>
                    <ul>
                        <li><strong>IDFA Management:</strong> Implement App Tracking Transparency (ATT) framework and handle IDFA availability gracefully</li>
                        <li><strong>SKAN Integration:</strong> For iOS 14.5+, implement SKAdNetwork integration alongside AppsFlyer SDK</li>
                        <li><strong>Universal Links:</strong> Configure Universal Links in your app and Apple's apple-app-site-association file</li>
                        <li><strong>Receipt Validation:</strong> Enable receipt validation in production to prevent fraud</li>
                        <li><strong>iOS Version Support:</strong> Keep SDK updated for compatibility with latest iOS versions</li>
                    </ul>
                </div>

                <div class="best-practice-section">
                    <h3>ü§ñ Android-Specific Best Practices</h3>
                    <ul>
                        <li><strong>GAID Integration:</strong> Ensure Google Advertising ID (GAID) is properly integrated for device identification</li>
                        <li><strong>Install Referrer:</strong> Implement Google Play Install Referrer library for accurate install tracking</li>
                        <li><strong>App Links:</strong> Configure App Links for Android deep linking and verify via Digital Asset Links file</li>
                        <li><strong>Permissions:</strong> Request only necessary permissions (INTERNET, ACCESS_NETWORK_STATE) and explain their purpose</li>
                        <li><strong>ProGuard Rules:</strong> Add proper ProGuard rules when obfuscating code to preserve AppsFlyer SDK functionality</li>
                    </ul>
                </div>

                <div class="best-practice-highlight" style="background: #fff3e0; border-left-color: #ff9800;">
                    <strong>‚ö†Ô∏è Production Deployment Checklist:</strong><br>
                    ‚Ä¢ Disable debug mode<br>
                    ‚Ä¢ Verify all analytics events are tracked<br>
                    ‚Ä¢ Test deep linking across all campaigns<br>
                    ‚Ä¢ Confirm attribution data appears in dashboard<br>
                    ‚Ä¢ Monitor SDK crash rates (should be <0.01%)<br>
                    ‚Ä¢ Validate consent handling works correctly<br>
                    ‚Ä¢ Set up alerts for tracking failures<br>
                    ‚Ä¢ Document all custom events and parameters
                </div>

                <div class="info-card" style="margin-top: 30px;">
                    <h3>üìö Additional Resources</h3>
                    <ul>
                        <li><a href="https://support.appsflyer.com" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">AppsFlyer Support Center</a> - Comprehensive documentation and FAQs</li>
                        <li><a href="https://dev.appsflyer.com" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">AppsFlyer Developer Hub</a> - Technical implementation guides</li>
                        <li><a href="https://support.appsflyer.com/hc/en-us/articles/207032246" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">OneLink Guide</a> - Creating and managing universal links</li>
                        <li><a href="https://www.appsflyer.com/blog" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">AppsFlyer Blog</a> - Latest industry insights and updates</li>
                    </ul>
                </div>

                <div class="info-card" style="margin-top: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>üèóÔ∏è SDK vs SDK-Less: Architecture Comparison</h3>
                    <p style="font-size: 14px; line-height: 1.6;">AppsFlyer offers flexible integration approaches. Choose based on your technical requirements:</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <!-- Native SDK -->
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #FFD700;">
                            <h4 style="margin-top: 0; color: #FFD700;">üì± Native SDK</h4>
                            <strong>Best For:</strong> Mobile apps with full feature requirements
                            <ul style="font-size: 13px; margin: 10px 0; padding-left: 20px;">
                                <li>Real-time event tracking</li>
                                <li>Uninstall measurement</li>
                                <li>Receipt validation</li>
                                <li>Deep linking (deferred)</li>
                                <li>Offline event queuing</li>
                                <li>Automatic user consent</li>
                            </ul>
                            <strong style="color: #4CAF50;">‚úì Pros:</strong>
                            <ul style="font-size: 13px; margin: 5px 0; padding-left: 20px; color: #C8E6C9;">
                                <li>Complete feature set</li>
                                <li>Automatic data collection</li>
                                <li>Better offline handling</li>
                            </ul>
                        </div>
                        
                        <!-- SDK-Less -->
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #FF6B6B;">
                            <h4 style="margin-top: 0; color: #FF6B6B;">üîó SDK-Less (S2S)</h4>
                            <strong>Best For:</strong> Backend-driven tracking & data privacy
                            <ul style="font-size: 13px; margin: 10px 0; padding-left: 20px;">
                                <li>Server-to-server data flow</li>
                                <li>Custom consent handling</li>
                                <li>Sensitive user data control</li>
                                <li>Third-party data integration</li>
                                <li>Bulk event reporting</li>
                                <li>Legacy system migration</li>
                            </ul>
                            <strong style="color: #4CAF50;">‚úì Pros:</strong>
                            <ul style="font-size: 13px; margin: 5px 0; padding-left: 20px; color: #C8E6C9;">
                                <li>Full data control</li>
                                <li>Privacy compliant</li>
                                <li>Backend flexibility</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Challenges Section -->
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong style="color: #FF6B6B;">‚ö†Ô∏è Challenges:</strong>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; font-size: 13px;">
                            <div>
                                <strong>Native SDK:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>App size increase</li>
                                    <li>Privacy concerns</li>
                                    <li>App store review risk</li>
                                    <li>Limited control over data</li>
                                </ul>
                            </div>
                            <div>
                                <strong>SDK-Less:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>No offline events</li>
                                    <li>No uninstall tracking</li>
                                    <li>Backend dependency</li>
                                    <li>Manual implementation</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hybrid Approach for Fintech -->
                <div class="info-card" style="margin-top: 30px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">
                    <h3>üí° Hybrid Approach: Recommended for Fintech & Regulated Industries</h3>
                    <p style="font-size: 14px; line-height: 1.6;">Combine both methods for maximum compliance and data control:</p>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong>üèÜ Why Hybrid for Fintech?</strong>
                        <ul style="font-size: 13px; margin-top: 10px; padding-left: 20px;">
                            <li><strong>Regulatory Compliance:</strong> GDPR, CCPA, PCI-DSS control via backend</li>
                            <li><strong>Data Sovereignty:</strong> Sensitive data never leaves your servers</li>
                            <li><strong>Audit Trail:</strong> Complete transparency through S2S logging</li>
                            <li><strong>User Consent:</strong> Granular control over what gets shared</li>
                            <li><strong>Risk Mitigation:</strong> No app-level tracking vulnerabilities</li>
                        </ul>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong>üîß Hybrid Implementation Pattern:</strong>
                        <div style="font-size: 13px; margin-top: 10px;">
                            <div style="margin-bottom: 10px;">
                                <strong>Layer 1 - Lightweight SDK (App)</strong>
                                <div style="margin-left: 15px; margin-top: 5px; font-style: italic; color: #C8E6C9;">
                                    Install tracking only ‚Ä¢ Session counting ‚Ä¢ Device identifiers
                                </div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>Layer 2 - Backend Processing (S2S)</strong>
                                <div style="margin-left: 15px; margin-top: 5px; font-style: italic; color: #C8E6C9;">
                                    Event enrichment ‚Ä¢ Consent validation ‚Ä¢ Data anonymization ‚Ä¢ Third-party sync
                                </div>
                            </div>
                            <div>
                                <strong>Layer 3 - Privacy Engine</strong>
                                <div style="margin-left: 15px; margin-top: 5px; font-style: italic; color: #C8E6C9;">
                                    PII redaction ‚Ä¢ Consent management ‚Ä¢ Data retention policies ‚Ä¢ Right-to-be-forgotten
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong>üìä Deployment Strategy:</strong>
                        <table style="width: 100%; font-size: 12px; margin-top: 10px; border-collapse: collapse;">
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <td style="padding: 8px; text-align: left;"><strong>Phase 1</strong></td>
                                <td>Minimal SDK for app launch events only</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <td style="padding: 8px;"><strong>Phase 2</strong></td>
                                <td>S2S API for all in-app events & transactions</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                                <td style="padding: 8px;"><strong>Phase 3</strong></td>
                                <td>Consent middleware integrated with your CMP</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;"><strong>Phase 4</strong></td>
                                <td>Privacy automation (GDPR/CCPA enforcement)</td>
                            </tr>
                        </table>
                    </div>

                    <div style="background: rgba(76, 175, 80, 0.2); padding: 12px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #4CAF50;">
                        <strong>üí∞ Fintech Example - Payment App:</strong>
                        <div style="font-size: 12px; margin-top: 8px;">
                            SDK sends: App install, session opens ‚Üí S2S processes: Transaction events (redacted), User acquisition source (from backend), Compliance events
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Attribution Waterfall Logic - AppsFlyer Priority Order
        function updateAttributionType() {
            const environment = document.querySelector('input[name="environment"]:checked').value;
            const consent = document.querySelector('input[name="consent"]:checked').value;
            
            let waterfall = [];
            let displayHTML = '';
            let bgColor = consent === 'present' ? '#d4edda' : '#fff3cd';
            
            if (consent === 'present') {
                // WITH CONSENT - Full Waterfall Priority
                if (environment === 'ios') {
                    waterfall = [
                        { priority: '1st', name: 'Deterministic Click-Through (IDFA)', accuracy: '99%+', signals: 'IDFA + Device Model + OS Version', color: '#0066FF' },
                        { priority: '2nd', name: 'Probabilistic Click-Through', accuracy: '65-80%', signals: 'IP Range + User-Agent + Browser Fingerprint + Timestamp', color: '#7B5BA3' },
                        { priority: '3rd', name: 'Deterministic View-Through', accuracy: '~90%', signals: 'IDFA + View timestamp', color: '#10B981' },
                        { priority: '4th', name: 'Probabilistic View-Through', accuracy: '55-70%', signals: 'Browser fingerprint + View context', color: '#F59E0B' }
                    ];
                } else if (environment === 'android') {
                    waterfall = [
                        { priority: '1st', name: 'Deterministic Click-Through (GAID)', accuracy: '99%+', signals: 'Google Advertising ID + Device Model + OS', color: '#0066FF' },
                        { priority: '2nd', name: 'Probabilistic Click-Through', accuracy: '65-80%', signals: 'IP Range + User-Agent + Browser Fingerprint + Timestamp', color: '#7B5BA3' },
                        { priority: '3rd', name: 'Deterministic View-Through', accuracy: '~90%', signals: 'GAID + View timestamp', color: '#10B981' },
                        { priority: '4th', name: 'Probabilistic View-Through', accuracy: '55-70%', signals: 'Browser fingerprint + View context', color: '#F59E0B' }
                    ];
                } else {
                    waterfall = [
                        { priority: '1st', name: 'Deterministic Click-Through', accuracy: '99%+', signals: 'Analytics ID + Device Fingerprint', color: '#0066FF' },
                        { priority: '2nd', name: 'Probabilistic Click-Through', accuracy: '70-85%', signals: 'IP Range + User-Agent + Browser + Timestamp', color: '#7B5BA3' },
                        { priority: '3rd', name: 'Deterministic View-Through', accuracy: '~85%', signals: 'Analytics ID + View timestamp', color: '#10B981' },
                        { priority: '4th', name: 'Probabilistic View-Through', accuracy: '60-75%', signals: 'Browser fingerprint + IP + Context', color: '#F59E0B' }
                    ];
                }
            } else {
                // NO CONSENT - Determine attribution method based on environment
                if (environment === 'ios' || environment === 'mobile-safari' || environment === 'desktop-mac') {
                    // iOS App, Mobile Safari, Desktop-Mac = SKAN 4.0 (clicks only, 0-35 days)
                    waterfall = [
                        { priority: '1st', name: 'SKAN 4.0 Deterministic Click (0-35 days)', accuracy: '~60%', signals: '‚ö†Ô∏è CLICKS ONLY | 6-bit Conversion Value + Campaign ID | Postback Windows: 0-2, 3-7, 8-35 days | Recent click within 0-35 days receives credit | Subject to anonymity & crowd tiers | ‚ùå VIEW-THROUGH COMPLETELY IGNORED', color: '#EF4444' }
                    ];
                } else {
                    // Android, Mobile Chrome, Mobile Firefox, Desktop Windows = AppsFlyer waterfall (clicks prioritized over views)
                    waterfall = [
                        { priority: '1st', name: 'Probabilistic Click-Through', accuracy: '70-85%', signals: 'IP Range (first 3 octets) + User-Agent + Browser + Timestamp | ‚ö†Ô∏è CLICKS PRIORITIZED OVER VIEWS', color: '#0066FF' },
                        { priority: '2nd', name: 'Probabilistic View-Through', accuracy: '55-70%', signals: 'Browser fingerprint + Cross-site tracking limited | View-through only if NO clicks found', color: '#7B5BA3' }
                    ];
                }
            }
            
            // Build waterfall display HTML
            displayHTML = '<div style="margin-top: 15px;">';
            waterfall.forEach((method, index) => {
                const isLast = index === waterfall.length - 1;
                const borderStyle = isLast ? '' : 'border-bottom: 2px solid #ddd;';
                
                displayHTML += `
                    <div style="display: flex; gap: 12px; padding: 12px 0; ${borderStyle} align-items: flex-start;">
                        <div style="background: ${method.color}; color: white; padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 11px; min-width: 45px; text-align: center;">
                            ${method.priority}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${method.name}</div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 4px;">
                                <strong>Accuracy:</strong> ${method.accuracy}
                            </div>
                            <div style="font-size: 11px; color: #777;">
                                <strong>Signals:</strong> ${method.signals}
                            </div>
                        </div>
                    </div>
                `;
            });
            displayHTML += '</div>';
            
            const displayDiv = document.getElementById('attribution-type-display');
            displayDiv.style.backgroundColor = bgColor;
            
            // Update main display
            const primaryMethod = waterfall[0];
            document.getElementById('attr-type-value').innerHTML = `
                <strong style="color: ${primaryMethod.color};">‚ñ∏ ${primaryMethod.name}</strong>
                <div style="font-size: 12px; color: #666; margin-top: 5px;">Accuracy: ${primaryMethod.accuracy}</div>
            `;
            document.getElementById('attr-accuracy').innerHTML = `
                <strong>Method Priority (Waterfall):</strong> AppsFlyer uses the highest priority available
            `;
            
            const signalsDiv = document.getElementById('attr-signals');
            if (displayHTML) {
                signalsDiv.innerHTML = displayHTML;
                signalsDiv.style.display = 'block';
                signalsDiv.style.marginTop = '15px';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateAttributionType();
        });

        const MEDIA_PARTNERS = {
            'google_search': { name: 'Google Search', clickWindow: { min: 1, max: 90, default: 30 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'google_dv360': { name: 'Google DV360', clickWindow: { min: 1, max: 30, default: 30 }, viewWindow: { min: 1, max: 7, default: 1 } },
            'amazon_dsp': { name: 'Amazon DSP', clickWindow: { min: 1, max: 7, default: 7 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'amazon_ads': { name: 'Amazon Ads', clickWindow: { min: 1, max: 30, default: 7 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'pinterest': { name: 'Pinterest', clickWindow: { min: 1, max: 30, default: 30 }, viewWindow: { min: 1, max: 7, default: 1 } },
            'reddit': { name: 'Reddit', clickWindow: { min: 7, max: 90, default: 90 }, viewWindow: { min: 1, max: 7, default: 1 } },
            'meta': { name: 'Meta', clickWindow: { min: 1, max: 7, default: 7 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'tiktok': { name: 'TikTok', clickWindow: { min: 1, max: 30, default: 7 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'snapchat': { name: 'Snapchat', clickWindow: { min: 1, max: 28, default: 28 }, viewWindow: { min: 1, max: 1, default: 1 } },
            'direct_buy': { name: 'Direct Buys', clickWindow: { min: 1, max: 60, default: 30 }, viewWindow: { min: 1, max: 1, default: 1 } }
        };

        let partners = [];
        let nextId = 1;

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const target = this.getAttribute('data-tab');
                const targetElement = document.getElementById(target);
                if (targetElement) {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    targetElement.classList.add('active');
                }
            });
        });

        window.copyCode = function(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text);
            event.target.textContent = '‚úÖ Copied!';
            setTimeout(() => event.target.textContent = 'üìã Copy Code', 2000);
        };

        function createAnimatedBubbles() {
            const container = document.getElementById('bubble-container');
            if (!container) return;
            const colors = ['blue', 'green', 'purple', 'pink', 'cyan'];
            const sizes = ['size-sm', 'size-md', 'size-lg'];
            for (let i = 0; i < 40; i++) {
                const bubble = document.createElement('div');
                bubble.className = `bubble ${colors[Math.floor(Math.random() * colors.length)]} ${sizes[Math.floor(Math.random() * sizes.length)]}`;
                const startX = Math.random() * 100;
                const offsetX = (Math.random() - 0.5) * 80;
                const duration = 3 + Math.random() * 2;
                const delay = i * 0.15;
                bubble.style.left = startX + '%';
                bubble.style.bottom = '-20px';
                bubble.style.animation = `float-up ${duration}s ease-in ${delay}s infinite`;
                bubble.style.setProperty('--tx', offsetX + 'px');
                container.appendChild(bubble);
            }
        }

        function renderPartner(id) {
            const container = document.getElementById('partners-container');
            let existing = container.querySelector(`[data-id="${id}"]`);
            if (existing) existing.remove();
            const partner = partners.find(p => p.id === id);
            const info = MEDIA_PARTNERS[partner.partner];
            const type = partner.type || 'Click-Through';
            const window = partner.window || (type === 'Click-Through' ? info.clickWindow.default : info.viewWindow.default);
            const card = document.createElement('div');
            card.className = 'partner-card';
            card.setAttribute('data-id', id);
            card.innerHTML = `<div class="partner-row">
                <div class="field-group"><label>Partner</label><select class="partner-select" data-id="${id}">${Object.entries(MEDIA_PARTNERS).map(([k, v]) => `<option value="${k}" ${k === partner.partner ? 'selected' : ''}>${v.name}</option>`).join('')}</select></div>
                <div class="field-group"><label>Type</label><select class="type-select" data-id="${id}"><option value="Click-Through" ${type === 'Click-Through' ? 'selected' : ''}>Click</option><option value="View-Through" ${type === 'View-Through' ? 'selected' : ''}>View</option></select></div>
                <div class="field-group"><label>Date</label><input type="date" class="date-input" data-id="${id}" value="${partner.date || ''}"></div>
                <div class="field-group"><label>Time</label><input type="time" class="time-input" data-id="${id}" value="${partner.time || ''}"></div>
                <div class="field-group"><label>Window</label><input type="number" class="window-input" data-id="${id}" min="1" max="90" value="${window}"></div>
                <button class="remove-btn" onclick="removePartner('${id}')">‚ùå</button></div>`;
            container.appendChild(card);
            card.querySelector('.partner-select').addEventListener('change', e => { partners.find(p => p.id === id).partner = e.target.value; });
            card.querySelector('.type-select').addEventListener('change', e => { partners.find(p => p.id === id).type = e.target.value; });
            card.querySelector('.date-input').addEventListener('change', e => { partners.find(p => p.id === id).date = e.target.value; });
            card.querySelector('.time-input').addEventListener('change', e => { partners.find(p => p.id === id).time = e.target.value; });
            card.querySelector('.window-input').addEventListener('change', e => { partners.find(p => p.id === id).window = parseInt(e.target.value); });
        }

        document.getElementById('add-partner-btn').addEventListener('click', () => {
            const id = nextId++;
            const first = Object.keys(MEDIA_PARTNERS)[0];
            partners.push({ id, partner: first, type: 'Click-Through', window: MEDIA_PARTNERS[first].clickWindow.default, date: new Date().toISOString().split('T')[0], time: '10:00' });
            renderPartner(id);
        });

        window.removePartner = (id) => {
            partners = partners.filter(p => p.id !== id);
            const card = document.querySelector(`[data-id="${id}"]`);
            if (card) card.remove();
        };

        document.getElementById('calculate-btn').addEventListener('click', () => {
            const installDate = document.getElementById('install-date').value;
            const installTime = document.getElementById('install-time').value;
            if (!installDate || !installTime || partners.length === 0) { alert('Complete all fields'); return; }
            const installDT = new Date(`${installDate}T${installTime}`);
            const events = [];
            partners.forEach(p => {
                if (p.date && p.time) {
                    const eventDT = new Date(`${p.date}T${p.time}`);
                    const daysDiff = (eventDT - installDT) / (1000 * 60 * 60 * 24);
                    const withinWindow = daysDiff <= 0 && daysDiff >= -p.window;
                    events.push({ id: p.id, partner: MEDIA_PARTNERS[p.partner].name, type: p.type, window: p.window, daysDiff: daysDiff, withinWindow: withinWindow });
                }
            });
            events.sort((a, b) => b.daysDiff - a.daysDiff);
            const clicksInWindow = events.filter(e => e.type === 'Click-Through' && e.withinWindow);
            const viewsInWindow = events.filter(e => e.type === 'View-Through' && e.withinWindow);
            let winner;
            if (clicksInWindow.length > 0) { 
                winner = clicksInWindow[0]; 
                winner.method = 'Last Click Attribution'; 
            } 
            else if (viewsInWindow.length > 0) { 
                winner = viewsInWindow[viewsInWindow.length - 1]; 
                winner.method = 'View-Through (No Clicks)'; 
            } 
            else { 
                winner = { partner: 'Organic', method: 'No paid attribution' }; 
            }
            document.getElementById('animation-container').style.display = 'block';
            document.getElementById('install-time-display').textContent = installDT.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            createAnimatedBubbles();
            const flowDiv = document.getElementById('events-flow');
            flowDiv.innerHTML = '';
            events.forEach((e, idx) => {
                const item = document.createElement('div');
                item.className = 'event-flow';
                item.style.animationDelay = `${idx * 0.2}s`;
                const icon = e.type === 'Click-Through' ? 'üñ±Ô∏è' : 'üëÅÔ∏è';
                const iconClass = e.type === 'Click-Through' ? 'icon-click' : 'icon-view';
                const isWinner = winner.id === e.id ? '<span style="color: #28a745; font-weight: 600;">‚úì WINNER</span>' : '';
                item.innerHTML = `<div class="event-icon ${iconClass}">${icon}</div><div style="flex: 1;"><strong>${e.partner}</strong> <span style="background: #667eea; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7em;">${e.type}</span> ${isWinner}<div style="font-size: 0.8em; color: #666; margin-top: 5px;">${e.daysDiff.toFixed(1)} days before</div></div>`;
                flowDiv.appendChild(item);
            });
            const resultsDiv = document.getElementById('results-container');
            resultsDiv.innerHTML = '';
            
            const environment = document.querySelector('input[name="environment"]:checked').value;
            const consent = document.querySelector('input[name="consent"]:checked').value;
            let attributionModel = '';
            
            // Attribution model logic based on environment and consent
            if (consent === 'present') {
                // WITH CONSENT - Full attribution
                if (environment === 'ios') {
                    attributionModel = 'Deterministic Click (IDFA)';
                } else if (environment === 'android') {
                    attributionModel = 'Deterministic Click (GAID)';
                } else {
                    attributionModel = 'Deterministic Click (Analytics ID)';
                }
            } else {
                // NO CONSENT - Different models based on environment
                if (environment === 'ios' || environment === 'mobile-safari' || environment === 'desktop-mac') {
                    // iOS App, Mobile Safari, Desktop-Mac = SKAN 4.0
                    attributionModel = 'SKAN 4.0 (0-35 Days, Clicks Only)';
                } else {
                    // Android, Mobile Chrome, Mobile Firefox, Desktop Windows = AppsFlyer Waterfall
                    attributionModel = 'AppsFlyer Waterfall (Clicks > Views)';
                }
            }
            
            const winnerBox = document.createElement('div');
            winnerBox.className = 'winner-box';
            winnerBox.innerHTML = `<div style="font-size: 3em;">üèÜ</div><h3>Winner</h3><div class="winner-partner">${winner.partner}</div><div class="winner-details"><strong>Method:</strong> ${winner.method}<br><strong>Attribution Model:</strong> ${attributionModel}</div>`;
            resultsDiv.appendChild(winnerBox);
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            partners = [];
            nextId = 1;
            document.getElementById('partners-container').innerHTML = '';
            document.getElementById('results-container').innerHTML = '<div class="no-results"><i class="fas fa-arrow-down" style="font-size: 2em;"></i><p>Add partners and calculate</p></div>';
            document.getElementById('animation-container').style.display = 'none';
        });

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('install-date').value = today;
        document.getElementById('install-time').value = '14:30';
    </script>
</body>
</html>
